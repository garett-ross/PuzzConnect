<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <div name="puzzle"></div>
        <script>
            class Card {
            constructor(name, group) {
            this.name = name;
            this.group = group;
            }
            }

            class Puzzle {
            constructor(cards) {
            this.cards = cards;
            }
            }

            const puzzle = new Puzzle([
            new Card("Metal", "Baby"),
            new Card("Jojo Maman", "Baby"),
            new Card("ccino", "Baby"),
            new Card("Ice ice", "Baby"),
            new Card("Sweet", "16"),
            new Card("4*4", "16"),
            new Card("Hexadecimal", "16"),
            new Card("Candles", "16"),
            new Card("Saggitarius/Capricorn", "December"),
            new Card("Christmas", "December"),
            new Card("12", "December"),
            new Card("Midwinter", "December"),
            new Card("Big dog foot", "Grandparents"),
            new Card("Pops out of her nightie", "Grandparents"),
            new Card("Clock", "Grandparents"),
            new Card("Babushka", "Grandparents")
            ]);

            const groupOptions = {
            Baby: ["baby"],
            16: ["16"],
            December: ["december"],
            Grandparents: ["grandmother", "grandfather", "grandparents"]
            };

            let points = 0;

            function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
            }
            }

            function renderPuzzle(puzzle) {
            const puzzleDiv = document.querySelector('[name="puzzle"]');
            puzzleDiv.innerHTML = '';
            shuffle(puzzle.cards);

            puzzle.cards.forEach((card, index) => {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            cardDiv.textContent = card.name;
            cardDiv.dataset.group = card.group;
            cardDiv.addEventListener('click', () => handleCardClick(cardDiv));
            puzzleDiv.appendChild(cardDiv);
            });
            }

            let selectedCards = [];
            let matchedGroups = [];
            let rowsMatched = 0;

            function handleCardClick(cardDiv) {
            if (selectedCards.includes(cardDiv)) {
            cardDiv.classList.remove('selected');
            selectedCards = selectedCards.filter(card => card !== cardDiv);
            } else {
            cardDiv.classList.add('selected');
            selectedCards.push(cardDiv);
            }

            if (selectedCards.length === 4) {
            checkSelection();
            }
            }

            function checkSelection() {
            const groups = selectedCards.map(card => card.dataset.group);
            const allSameGroup = groups.every(group => group === groups[0]);

            if (allSameGroup) {
            alert('Correct group!');
            selectedCards.forEach(card => {
            card.classList.add('matched');
            matchedGroups.push(card);
            });
            rowsMatched++;
            points++; // Add 1 point for connecting a row
            updatePointsDisplay();
            arrangeMatchedCards();
            if (rowsMatched === 4) {
            highlightRowsAndPrompt();
            }
            } else {
            alert('Incorrect group. Try again.');
            }

            selectedCards.forEach(card => card.classList.remove('selected'));
            selectedCards = [];
            }

            function arrangeMatchedCards() {
            const puzzleDiv = document.querySelector('[name="puzzle"]');
            const matchedCards = puzzleDiv.querySelectorAll('.card.matched');
            const unmatchedCards = puzzleDiv.querySelectorAll('.card:not(.matched)');

            puzzleDiv.innerHTML = '';

            matchedCards.forEach(card => puzzleDiv.appendChild(card));
            unmatchedCards.forEach(card => puzzleDiv.appendChild(card));
            }

            function highlightRowsAndPrompt() {
            const puzzleDiv = document.querySelector('[name="puzzle"]');
            const rows = Array.from(puzzleDiv.children).reduce((acc, card, index) => {
            const rowIndex = Math.floor(index / 4);
            if (!acc[rowIndex]) acc[rowIndex] = [];
            acc[rowIndex].push(card);
            return acc;
            }, []);

            let currentRow = 0;

            function promptForRowConnection() {
            if (currentRow < rows.length) {
            rows[currentRow].forEach(card => card.classList.add('highlight'));
            const userInput = prompt(`What is the connection for row ${currentRow + 1}?`);
            if (userInput && isFuzzyMatch(userInput, groupOptions[rows[currentRow][0].dataset.group])) {
            alert('Correct connection!');
            points++; // Add 1 point for guessing the connection
            updatePointsDisplay(); // Update points immediately
            if (currentRow === 2) {
            arrangeRow4AfterRow3(rows[3]);
            }
            } else {
            alert('Incorrect connection. Try again.');
            }
            rows[currentRow].forEach(card => card.classList.remove('highlight'));
            currentRow++;
            promptForRowConnection();
            } else {
            alert('All rows have been guessed!');
            askFinalQuestion();
            }
            }

            promptForRowConnection();
            }

            function arrangeRow4AfterRow3(row4) {
            const puzzleDiv = document.querySelector('[name="puzzle"]');
            row4.forEach(card => {
            card.classList.add('highlight');
            puzzleDiv.appendChild(card);
            });
            }

            function updatePointsDisplay() {
            const pointsDisplay = document.querySelector('#points-display');
            pointsDisplay.textContent = `Points: ${points}`;
            }

            function isFuzzyMatch(input, options) {
            const normalizedInput = input.trim().toLowerCase();
            return options.some(option => option.includes(normalizedInput) || normalizedInput.includes(option));
            }

            function askFinalQuestion() {
            const answer = prompt("What is Catriona's secret?");
            if (answer && answer.toLowerCase() === "we're havin a baby, the due date is 16th december") {
            alert("Correct! Congratulations!");
            points += 5; // Add bonus points for the final question
            updatePointsDisplay();
            } else {
            alert("Incorrect. The correct answer is: We're havin a baby, the due date is 16th December");
            }
            }

            document.addEventListener('DOMContentLoaded', () => {
            const pointsDisplay = document.createElement('div');
            pointsDisplay.id = 'points-display';
            pointsDisplay.style.marginBottom = '20px';
            pointsDisplay.textContent = `Points: ${points}`;
            document.body.insertBefore(pointsDisplay, document.body.firstChild);
            });

            renderPuzzle(puzzle);
        </script>
        <style>
            [name="puzzle"] {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            }

            .card {
            padding: 20px;
            text-align: center;
            border: 1px solid #ccc;
            cursor: pointer;
            background-color: #f9f9f9;
            }

            .card.selected {
            background-color: #d3f9d8;
            }

            .card.matched {
            background-color: #a8e6cf;
            pointer-events: none;
            }

            .card.highlight {
            border: 2px solid #ffeb3b;
            }

            #points-display {
            font-size: 18px;
            font-weight: bold;
            }
        </style>
        <script src="" async defer></script>
    </body>
</html>